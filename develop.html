

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating New Device Types &mdash; Happi Deck 1.1.2+15.g9433797 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Client API" href="client_api.html" />
    <link rel="prev" title="Using the Client" href="client.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Happi Deck
          

          
          </a>

          
            
            
              <div class="version">
                1.1.2+15.g9433797
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Using the Client</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating New Device Types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#entry-info">Entry Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-device">Using a Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-class">Example Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-devices">Loading Devices</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="client_api.html">Client API</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">Supported Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Device Containers</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Happi Deck</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Creating New Device Types</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/develop.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-new-device-types">
<h1>Creating New Device Types<a class="headerlink" href="#creating-new-device-types" title="Permalink to this headline">¶</a></h1>
<p>Container objects are built using both the base <a class="reference internal" href="containers.html#happi.Device" title="happi.Device"><code class="xref py py-class docutils literal notranslate"><span class="pre">Device</span></code></a> class as well
as instances of the <a class="reference internal" href="#happi.device.EntryInfo" title="happi.device.EntryInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntryInfo</span></code></a>.</p>
<div class="section" id="entry-info">
<h2>Entry Info<a class="headerlink" href="#entry-info" title="Permalink to this headline">¶</a></h2>
<p>In order to regulate and template the information that gets entered into the
Happi database, we use the concept of device containers. This allows a
developer to specify fields that are inherit to every device of a specific
type, in addition by specifying these keys using the <a class="reference internal" href="#happi.device.EntryInfo" title="happi.device.EntryInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntryInfo</span></code></a>
object, you have even greater control by declaring optional vs. mandatory,
default options when a user does not enter the value, and enforce specific
types.</p>
<dl class="class">
<dt id="happi.device.EntryInfo">
<em class="property">class </em><code class="descclassname">happi.device.</code><code class="descname">EntryInfo</code><span class="sig-paren">(</span><em>doc=None</em>, <em>optional=True</em>, <em>enforce=None</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#happi.device.EntryInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>A piece of information related to a specific device</p>
<p>These are entered as class attributes for a given device container. They
help control the information entered into a device</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>doc</strong> (<em>str</em>) – A short string to document the device</li>
<li><strong>optional</strong> (<em>bool</em><em>, </em><em>optional</em>) – By default all EntryInfo is optional, but in certain cases you may want
to demand a particular piece of information upon initialization</li>
<li><strong>enforce</strong> (<em>type</em><em>, </em><em>list</em><em>, </em><em>compiled regex</em><em>, </em><em>optional</em>) – Specify that all entered information is entered in a specific format.
This can either by a Python type i.e. int, float e.t.c., a list of
acceptable values, or a compiled regex pattern i.e <code class="docutils literal notranslate"><span class="pre">re.compile(...)</span></code></li>
<li><strong>default</strong> (<em>optional</em>) – A default value for the trait to have if the user does not specify.
Keep in mind that this should be the same type as <code class="docutils literal notranslate"><span class="pre">enforce</span></code> if you
are demanding a certain type.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">ContainerError: – If there is an error with the way the enforced value interacts with its
default value, or if the piece of information entered is unenforcable
based on the the settings</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

    <span class="n">my_field</span> <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;My generated field&#39;</span><span class="p">)</span>
    <span class="n">number</span>   <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;Device number&#39;</span><span class="p">,</span> <span class="n">enforce</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="happi.device.EntryInfo.enforce_value">
<code class="descname">enforce_value</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#happi.device.EntryInfo.enforce_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Enforce the rules of the EntryInfo</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Identical to the provided value except it may have been converted
to the correct type</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">value</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body">ValueError: – If the value is not the correct type, or does not match the pattern</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="using-a-device">
<h2>Using a Device<a class="headerlink" href="#using-a-device" title="Permalink to this headline">¶</a></h2>
<p>In order to ensure that information is entered into the database in an
organized fashion, the client will only accept classes that inherit from
<a class="reference internal" href="containers.html#happi.Device" title="happi.Device"><code class="xref py py-class docutils literal notranslate"><span class="pre">Device</span></code></a>. Each device will have the key information represented as
class attributes, available to be manipulated like any other regular property</p>
<p>Editing the information for a container is a simple as:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">happi</span> <span class="kn">import</span> <span class="n">Device</span>

<span class="gp">In [2]: </span><span class="n">device</span> <span class="o">=</span> <span class="n">Device</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_device&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">device</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;new_name&#39;</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="containers.html#happi.Device" title="happi.Device"><code class="xref py py-class docutils literal notranslate"><span class="pre">Device</span></code></a> class also supports extraneous data that may not have been
captured when the original container was created. You can either enter this as
a keyword, or enter it into the <a class="reference internal" href="containers.html#happi.Device.extraneous" title="happi.Device.extraneous"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Device.extraneous</span></code></a> dictionary.</p>
<p>While you are free to play around with the device attributes, when loading the
object into the database you will need to make sure that all of the
<a class="reference internal" href="containers.html#happi.Device.mandatory_info" title="happi.Device.mandatory_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Device.mandatory_info</span></code></a> has been entered, otherwise the client
will reject the device.</p>
</div>
<div class="section" id="example-class">
<h2>Example Class<a class="headerlink" href="#example-class" title="Permalink to this headline">¶</a></h2>
<p>In order to show the flexibility of the <a class="reference internal" href="#happi.device.EntryInfo" title="happi.device.EntryInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntryInfo</span></code></a> class, we’ll put
together an example container. The class can be invoked in the same way you
would usually handle class inheritance, the only difference is that you specify
class attributes as EntryInfo objects:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">happi.device</span> <span class="k">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">EntryInfo</span>

<span class="k">class</span> <span class="nc">MyDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

    <span class="n">model_no</span>      <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;Model Number of Device&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">count</span>         <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;Count of Device&#39;</span><span class="p">,</span> <span class="n">enforce</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">choices</span>       <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;Choice Info&#39;</span><span class="p">,</span> <span class="n">enforce</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">])</span>
    <span class="n">no_whitespace</span> <span class="o">=</span> <span class="n">EntryInfo</span><span class="p">(</span><span class="s1">&#39;Enforce no whitespace&#39;</span><span class="p">,</span>
                               <span class="n">enforce</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\S]*$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, EntryInfo will create an optional keyword, whose default is
<code class="docutils literal notranslate"><span class="pre">None</span></code> with the same name as the class attribute. You can always see how this
information will be put into the the database by looking at the output of the
<a class="reference internal" href="containers.html#happi.Device.post" title="happi.Device.post"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Device.post()</span></code></a> method. As shown in the example above, using the EntryInfo
keywords, you can put a short doc string to give a better explanation of the
field, and also enforce that user enter a specific format of information.</p>
<p>While the user will always be able to enter <code class="docutils literal notranslate"><span class="pre">None</span></code> for the attribute, if a
real value is given it will be checked against the specified <code class="docutils literal notranslate"><span class="pre">enforce</span></code>
keyword, raising <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if invalid. Here is a table for how the
<a class="reference internal" href="#happi.device.EntryInfo" title="happi.device.EntryInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntryInfo</span></code></a> check the type</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Enforce</th>
<th class="head">Method of enforcement</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>None</td>
<td>Any value will work</td>
</tr>
<tr class="row-odd"><td>type</td>
<td>type(value)</td>
</tr>
<tr class="row-even"><td>list</td>
<td>list.index(value)</td>
</tr>
<tr class="row-odd"><td>regex</td>
<td>regex.match(value) != None</td>
</tr>
</tbody>
</table>
<p>Finally, fields that are important to the device can be marked as mandatory.
These should have no default value. When entering information you will not
neccesarily see a difference in between optional and mandatory
<a class="reference internal" href="#happi.device.EntryInfo" title="happi.device.EntryInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">EntryInfo</span></code></a>, however the database client will reject the device if
these fields don’t have values associated with them.</p>
</div>
<div class="section" id="loading-devices">
<h2>Loading Devices<a class="headerlink" href="#loading-devices" title="Permalink to this headline">¶</a></h2>
<p>Part of happi’s job is to contain the information necessary to load the Python
representation of an object. This information is stored as a <code class="docutils literal notranslate"><span class="pre">device_class</span></code>,
<code class="docutils literal notranslate"><span class="pre">args</span></code> and <code class="docutils literal notranslate"><span class="pre">kwargs</span></code>. The former stores a string that indicates the Python
class of the device, the other two indicate the information that is needed to
instantiate it. With this information both <a class="reference internal" href="containers.html#happi.from_container" title="happi.from_container"><code class="xref py py-func docutils literal notranslate"><span class="pre">from_container()</span></code></a> and
<a class="reference internal" href="containers.html#happi.load_devices" title="happi.load_devices"><code class="xref py py-func docutils literal notranslate"><span class="pre">load_devices()</span></code></a> will handle importing modules and instantiating your
device. To keep track of the container the device that was instantiated has an
attribute attached <code class="docutils literal notranslate"><span class="pre">.md</span></code> which will return the original container.</p>
<p>Often information contained in the <code class="docutils literal notranslate"><span class="pre">args</span></code> or <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> will be duplicated in
other parts of the container. For instance most <code class="docutils literal notranslate"><span class="pre">ophyd</span></code> objects will want a
<code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">prefix</span></code> on initialization. Instead of repeating that
information you can just use a template and have the information automatically
populated for you by the container itself. For instance, in the aforementioned
example <cite>device.args = [“{{prefix}}”]</cite> would substitute the attribute listed as
<cite>Device.prefix</cite> in as an argument. If the template contains the substituted
attribute alone the type will also be converted.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="client_api.html" class="btn btn-neutral float-right" title="Client API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="client.html" class="btn btn-neutral" title="Using the Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SLAC National Accelerator Laboratory

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>